<link rel="import" href="../../polymer/polymer.html">

<template>
  <div>
    <label>
      <input type="checkbox" id="isWebSocket">
      WebSocket
    </label>
  </div>
</template>

<script>
  (function (window, document) {
    var thatDoc = document;

    var thisDoc = (thatDoc._currentScript || thatDoc.currentScript).ownerDocument;

    var template = thisDoc.querySelector('template').content;

    var element = Object.create(HTMLElement.prototype);

    element.createdCallback = function () {
      this.createShadowRoot();
    };

    function isUseWebSocket(useWebSocketStr) {
      if (!useWebSocketStr) {
        return true;
      }
      else if (useWebSocketStr == "false") {
        return false;
      }
      else {
        return true;
      }
    }

    function getPuppet() {
      return document.querySelector('puppet-js') || document.querySelector('puppet-client') || window.puppet;
    };

    element.attachedCallback = function () {
      var clone = thatDoc.importNode(template, true);

      clone.querySelector('#isWebSocket').checked = isUseWebSocket(window.localStorage.getItem("launcher-puppet-js-useWebSocket"))

      clone.querySelector('#isWebSocket').addEventListener('change', function (ev) {
        var newVal = ev.target.checked;
        var puppet = getPuppet();
        if (puppet) {
          puppet.useWebSocket = newVal;
        }
        window.localStorage.setItem("launcher-puppet-js-useWebSocket", newVal);
      });

      this.shadowRoot.appendChild(clone);
    };

    document.registerElement('puppet-js-settings', {
      prototype: element
    });
  }(window, document));
</script>
