<!--<link rel="import" href="juicy-error-stacktrace-reporter.html">-->
<!--<link rel="import" href="fast-json-patch-error-reporter.html">-->
<!--<link rel="import" href="juicy-error-dialog.html">-->
<link rel="import" href="puppet-js-view-model-tree.html">

<polymer-element name="starcounter-debug-aid">
  <template>
    <style>
      :host {
        font-family: sans-serif;
      }

      #overlay {
        position: fixed;
        z-index: 9999;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
      }

      #overlay.hidden {
        display: none;
      }

      #dialog {
        width: 90vw;
        margin-top: 5vh;
      }

      .tab-content {
        background: white;
        box-shadow: 0 13px 25px 0 rgba(0, 0, 0, 0.3);
        padding: 4px 4px 4px 4px;
        display: none;
        max-height: calc(90vh - 50px);
      }

      [type=radio] {
        display: none;
      }

      label {
        background: linear-gradient(to bottom, #eee 0%, #ddd 100%);
        padding: 10px;
        display: inline-block;
        margin-right: -0.3em;
      }

      [type=radio]:checked + * + label {
        /* number of asterisks must equal the number of tabs - 1 */
        background: white;
      }

      [type=radio]:checked + * + * + * + .tab-content {
        /* number of asterisks must equal the number of tabs + 1 */
        display: flex;
      }
    </style>

    <div id="overlay" class="hidden">
      <div id="dialog">

        <input id="tab1" name="tab-control" type="radio" checked>
        <input id="tab2" name="tab-control" type="radio">

        <label for="tab1">View-model</label>
        <label for="tab2">Help</label>

        <div class="tab-content">
          <puppet-js-view-model-tree></puppet-js-view-model-tree>
        </div>

        <div class="tab-content">
          <div>
            <h1>Starcounter Debug Aid</h1>

            <p>Suggestions and bug reports welcome at <a href="https://github.com/Polyjuice/starcounter-debug-aid">GitHub
              Issues</a>.</p>
          </div>

          <!-- uncomment with a nice tabbed UI and no errors in Launcher
          <juicy-error-dialog id="errorDialog" on-error-catched="{{openDialog}}">
            <template>
              <fast-json-patch-error-reporter></fast-json-patch-error-reporter>
              <juicy-error-stacktrace-reporter></juicy-error-stacktrace-reporter>
            </template>
          </juicy-error-dialog>-->
        </div>
      </div>
    </div>
    </div>
    <content></content>
  </template>
  <script>
    Polymer("starcounter-debug-aid", {
      ready: function () {
        var that = this;
        window.addEventListener("keyup", function (ev) {
          if ((ev.keyCode === 192 || ev.keyCode === 220) && (ev.ctrlKey || ev.metaKey)) { //CTRL+` (Windows) or CMD+ยง (Mac) or CTRL+/ (Windows+Parallels)
            if (that.$.overlay.classList.contains("hidden")) {
              that.openDialog();
            }
            else {
              that.closeDialog();
            }
          }
          else if (ev.keyCode === 27) { //Esc
            if (!that.$.overlay.classList.contains("hidden")) {
              that.closeDialog();
            }
          }
        });
        //window.addEventListener("error", this.openDialog.bind(this));
        this.$.overlay.addEventListener("click", function (ev) {
          if (ev.target === that.$.overlay || ev.target === that.$.dialog) {
            that.closeDialog();
          }
        });
      },
      closeDialog: function () {
        this.$.overlay.classList.add("hidden");
        //this.$.errorDialog.reset();
      },
      openDialog: function () {
        this.$.overlay.classList.remove("hidden");
        this.shadowRoot.querySelector("input").checked = true; //open first tab
      }
    });
  </script>
</polymer-element>
